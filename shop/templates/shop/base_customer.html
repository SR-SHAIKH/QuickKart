{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}LocalShop{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    <style>
      .search-wrapper {
        transition: all 0.3s ease;
        width: 36px;
        overflow: hidden;
        background-color: transparent;
        display: flex;
        align-items: center;
        border-radius: 9999px;
      }

      .search-wrapper.expanded {
        width: 15vw;
        background-color: white;
        padding-left: 0.5rem;
      }

      .search-wrapper input {
        width: 0;
        border: none;
        outline: none;
        background-color: transparent;
        transition: width 0.3s ease;
      }

      .search-wrapper.expanded input {
        width: 100%;
      }

      .profile-pic {
        width: 36px;
        height: 36px;
        object-fit: cover;
        border-radius: 50%;
      }
    </style>
  </head>

  <body class="bg-gray-100 text-gray-800">
    <!-- âœ… NAVBAR -->
    <nav class="bg-green-600 py-3 shadow text-white">
      <div class="container d-flex justify-between align-items-center">
        <!-- Logo as link to home -->
        <a
          href="{% url 'product_list' %}"
          class="text-white text-decoration-none"
        >
          <h1 class="text-2xl fw-bold">LocalShop</h1>
        </a>

        <div class="d-flex align-items-center gap-4">
          <!-- ðŸ” Expanding Search -->
          <form
            method="get"
            action="{% url 'search' %}"
            class="position-relative"
          >
            <div id="searchBox" class="search-wrapper">
              <input
                type="text"
                name="q"
                value="{{ request.GET.q }}"
                placeholder="Search..."
                class="text-black bg-transparent py-1"
              />
              <button type="button" id="searchToggle" class="btn p-0 px-2">
                <i id="searchIcon" class="bi bi-search text-white"></i>
              </button>
            </div>
          </form>

          <!-- Cart -->
          <a href="{% url 'cart_view' %}" class="text-white">
            <i class="bi bi-cart-fill" style="font-size: 1.4rem"></i>
          </a>

          {% if request.user.is_authenticated %}
          <!-- Profile Dropdown -->
          <div class="dropdown">
            <a
              class="dropdown-toggle d-flex align-items-center"
              href="#"
              role="button"
              id="profileDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <img
                src="{% if request.user.profile_picture %}{{ request.user.profile_picture.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}"
                alt="Profile"
                class="profile-pic"
              />
            </a>
            <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="profileDropdown"
            >
              {% if request.user.role == 'customer' %}
              <li>
                <a class="dropdown-item" href="{% url 'customer_profile' %}"
                  >Profile</a
                >
              </li>
              {% elif request.user.role == 'shop_owner' %}
              <li>
                <a class="dropdown-item" href="{% url 'owner_profile' %}"
                  >Profile</a
                >
              </li>
              {% endif %}
              <li>
                <a class="dropdown-item" href="{% url 'wishlist_page' %}"
                  >Wishlist</a
                >
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item text-danger" href="{% url 'logout' %}"
                  >Logout</a
                >
              </li>
            </ul>
          </div>
          {% else %}
          <a href="{% url 'login' %}" class="text-white">Login</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- âœ… BODY -->
    <main class="container my-5">{% block content %}{% endblock %}</main>

    <!-- âœ… JS -->
    <script>
      const searchBox = document.getElementById("searchBox");
      const searchToggle = document.getElementById("searchToggle");
      const searchInput = searchBox.querySelector("input");
      const searchIcon = document.getElementById("searchIcon");

      searchToggle.addEventListener("click", function (e) {
        e.preventDefault();

        const isExpanded = searchBox.classList.contains("expanded");

        if (!isExpanded) {
          searchBox.classList.add("expanded");
          searchIcon.classList.replace("text-white", "text-black");
          setTimeout(() => searchInput.focus(), 100);
        } else {
          if (searchInput.value.trim()) {
            searchBox.closest("form").submit();
          } else {
            searchBox.classList.remove("expanded");
            searchInput.value = "";
            searchIcon.classList.replace("text-black", "text-white");
          }
        }
      });

      // Click outside to close
      document.addEventListener("click", function (e) {
        if (!searchBox.contains(e.target) && !searchToggle.contains(e.target)) {
          searchBox.classList.remove("expanded");
          searchInput.value = "";
          searchIcon.classList.replace("text-black", "text-white");
        }
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
