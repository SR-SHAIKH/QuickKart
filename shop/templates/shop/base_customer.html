{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}QuickKart{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />

    <style>
      .search-wrapper {
        transition: all 0.3s ease;
        width: 36px;
        overflow: hidden;
        background-color: transparent;
        display: flex;
        align-items: center;
        border-radius: 9999px;
      }

      .search-wrapper.expanded {
        width: 15vw;
        background-color: white;
        padding-left: 0.5rem;
      }

      .search-wrapper input {
        width: 0;
        border: none;
        outline: none;
        background-color: transparent;
        transition: width 0.3s ease;
      }

      .search-wrapper.expanded input {
        width: 100%;
      }

      .profile-pic {
        width: 36px;
        height: 36px;
        object-fit: cover;
        border-radius: 50%;
      }
    </style>
  </head>

  <body class="bg-gray-100 text-gray-800">
    <!-- ‚úÖ TOAST NOTIFICATIONS -->
    <div id="toast-container" class="fixed top-6 right-6 z-50 flex flex-col gap-3"></div>
    {% if messages %}
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          {% for message in messages %}
            showToast("{{ message|escapejs }}", "{{ message.tags }}");
          {% endfor %}
        });
      </script>
    {% endif %}
    <script>
      function showToast(msg, type) {
        const colors = {
          success: 'bg-green-700',
          error: 'bg-red-600',
          warning: 'bg-yellow-400 text-black',
          info: 'bg-blue-700',
        };
        const color = colors[type] || 'bg-green-900';
        const toast = document.createElement('div');
        toast.className = `min-w-[220px] max-w-xs px-5 py-3 rounded-lg shadow-lg text-white font-semibold flex items-center gap-2 ${color} animate-fade-in`;
        toast.innerHTML = `<span>${msg}</span>`;
        document.getElementById('toast-container').appendChild(toast);
        setTimeout(() => {
          toast.classList.add('opacity-0');
          setTimeout(() => toast.remove(), 400);
        }, 3000);
      }
    </script>
    <style>
      @keyframes fade-in {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-fade-in {
        animation: fade-in 0.3s;
      }
    </style>
    <!-- ‚úÖ NAVBAR -->
    <nav class="bg-green-600 py-3 shadow text-white">
      <div class="container d-flex justify-content-between align-items-center">
        <!-- Logo Section -->
        <div>
          {% if request.user.is_authenticated %}
            {% if request.user.role == 'shop_owner' %}
              <h1 class="text-2xl fw-bold text-white mb-0" style="cursor: default;">QuickKart</h1>
            {% else %}
              <a href="{% url 'home' %}" class="text-white text-decoration-none">
                <h1 class="text-2xl fw-bold mb-0">QuickKart</h1>
              </a>
            {% endif %}
          {% else %}
            <a href="{% url 'home' %}" class="text-white text-decoration-none">
              <h1 class="text-2xl fw-bold mb-0">QuickKart</h1>
            </a>
          {% endif %}
        </div>

        <!-- Right Section -->
        <div class="d-flex align-items-center gap-4">
          {% if request.user.is_authenticated %}
            <!-- Cart -->
            <a href="{% url 'cart_view' %}" class="text-white">
              <i class="bi bi-cart-fill" style="font-size: 1.4rem"></i>
            </a>

            <!-- Profile Dropdown -->
            <div class="dropdown">
              <a
                class="d-flex align-items-center"
                href="#"
                role="button"
                id="profileDropdown"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <img
                  src="{% if request.user.profile_picture %}{{ request.user.profile_picture.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}"
                  alt="Profile"
                  class="profile-pic"
                />
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                {% if request.user.role == 'customer' %}
                  <li><a class="dropdown-item" href="{% url 'customer_profile' %}">Profile</a></li>
                {% elif request.user.role == 'shop_owner' %}
                  <li><a class="dropdown-item" href="{% url 'owner_profile' %}">Profile</a></li>
                {% endif %}
                <li><a class="dropdown-item" href="{% url 'wishlist_page' %}">Wishlist</a></li>
                <li><hr class="dropdown-divider" /></li>
                <li><a href="#" class="dropdown-item text-danger" data-bs-toggle="modal" data-bs-target="#logoutConfirmModal">Logout</a></li>
              </ul>
            </div>
          {% else %}
            <!-- Login & Register Buttons -->
            <a href="{% url 'login' %}" class="text-white me-3">Login</a>
            <a href="#" class="text-white" data-bs-toggle="modal" data-bs-target="#registerModal">Register</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- ‚úÖ BODY -->
    <main class="container my-5">
      {% block content %}{% endblock %}
    </main>

    <!-- ‚úÖ Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4 rounded-4">
          <h5 class="modal-title text-center mb-3" id="registerModalLabel">Register As</h5>
          <div class="d-flex flex-column gap-3">
            <a href="{% url 'register' %}?role=customer" class="btn btn-outline-primary">üßë Register as Customer</a>
            <a href="{% url 'register' %}?role=shop_owner" class="btn btn-outline-success">üè™ Register as Shop Owner</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Logout Confirmation Modal -->
    <div class="modal fade" id="logoutConfirmModal" tabindex="-1" aria-labelledby="logoutConfirmModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3 rounded-3">
          <div class="modal-header">
            <h5 class="modal-title" id="logoutConfirmModalLabel">Confirm Logout</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to log out?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <a href="{% url 'logout' %}" class="btn btn-danger">Yes, Logout</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚úÖ JS -->
    <script>
      const searchBox = document.getElementById("searchBox");
      const searchToggle = document.getElementById("searchToggle");
      const searchInput = searchBox?.querySelector("input");
      const searchIcon = document.getElementById("searchIcon");

      if (searchToggle) {
        searchToggle.addEventListener("click", function (e) {
          e.preventDefault();
          const isExpanded = searchBox.classList.contains("expanded");

          if (!isExpanded) {
            searchBox.classList.add("expanded");
            searchIcon.classList.replace("text-white", "text-black");
            setTimeout(() => searchInput.focus(), 100);
          } else {
            if (searchInput.value.trim()) {
              searchBox.closest("form").submit();
            } else {
              searchBox.classList.remove("expanded");
              searchInput.value = "";
              searchIcon.classList.replace("text-black", "text-white");
            }
          }
        });

        document.addEventListener("click", function (e) {
          if (!searchBox.contains(e.target) && !searchToggle.contains(e.target)) {
            searchBox.classList.remove("expanded");
            searchInput.value = "";
            searchIcon.classList.replace("text-black", "text-white");
          }
        });
      }
    </script>

    <!-- ‚úÖ Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
